<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Composer: Share all the things!</title>
    <link rel="stylesheet" href="components/require.css">
    <link rel="stylesheet" href="components/revealjs/css/theme/default.css">
    <style>
      dl {
        text-align: left;
      }
      dl dd {
        text-indent: 2em;
      }
      code {
        width: 100%;
      }
      span.highlight {
        color: #00B0E8;
      }
    </style>
  </head>
  <body>
    <div class="reveal">
      <div class="slides">
        <section data-state="blackout">
          <h1>Composer</h1>
          <h3>Share all the things!</h3>
          <a href="#" class="image">
              <img width="300" height="356" src="assets/composer.png" alt="Composer" style="border: none; background: white;">
          </a>
          <p>
            <small>Presented by <a href="http://www.garfieldtech.com/">Larry Garfield</a></small>
          </p>
        </section>
         <section>
          <h2><a href="http://twitter.com/Crell">@Crell</a></h2>
          <img src="assets/palantirnet-logo-2013.svg" alt="Palantir.net Pays me!" style="width: 300px; background: #FFF; float: right;" />
          <ul>
            <li>Senior Architect, <a href="http://www.palantir.net/">Palantir.net</a></li>
            <li>Drupal 8 Web Services Lead</li>
            <li>Drupal Representative, <a href="http://www.php-fig.org/">PHP-FIG</a></li>
            <li>Advisor, Drupal Association</li>
            <li>General busybody</li>
          </ul>
        </section>
        <section>
          <section data-state="alert">
            <h2>Dependency management sucks</h2>
          </section>
          <section>
            <h2>PHP sucks at sharing</h2>
            <ul>
              <li class="fragment">How do I get a 3rd party library?</li>
              <li class="fragment">Where do I put the files?</li>
              <li class="fragment">How do I load its code?</li>
              <li class="fragment">Does it depend on anything?</li>
              <li class="fragment">Does it go in my repo or not?</li>
            </ul>
          </section>
          <section>
            <p>Sharing is how Open Source works</p>
            <br />
            <p>Sucking at sharing is how<br />Open Source dies</p>
          </section>
          <section>
            <h2>But my framework is extensible!</h2>
            <ul>
              <li class="fragment">Not all code is for your project</li>
              <li class="fragment">Duplicate work elsewhere</li>
              <li class="fragment">Code is not reusable</li>
            </ul>
          </section>
          <section>
            <h2>3rd party code</h2>
            <p>Bridging code to your framework</p>
            <ul>
              <li class="fragment">Manually download into your framework and pray</li>
              <li class="fragment">Manually download into some magic directory and pray</li>
              <li class="fragment">Manually setup include calls</li>
            </ul>
            <p class="fragment roll-in" style="text-align: right">(... and pray)</p>
          </section>
          <section>
            <p>"Do it manually and pray" is for losers</p>
            <p class="fragment roll-in" style="margin-top: 1em; font-style: italic;">We're better than that, right?</p>
          </section>
        </section>
        <section>
          <section fullscreen-img="assets/history.jpg" class="fullscreen">
            <h1>A little history</h1>
          </section>
          <section fullscreen-img="assets/history.jpg" class="fullscreen">
            <h2>PEAR</h2>
            <img src="assets/pear.gif" alt="PEAR" style="background: none; border: none; position: absolute; bottom:0; right:0; z-index:-1000;">
            <ul>
              <li class="fragment">PHP Extension and Application Repository</li>
              <li class="fragment">Founded 2000 on the "new" PHP 4</li>
              <li class="fragment">Required root to use properly (WTF?)</li>
              <li class="fragment">Complex process for adding packages</li>
              <li class="fragment">Easy to get wrong</li>
            </ul>
          </section>
          <section fullscreen-img="assets/history.jpg" class="fullscreen">
            <h2>Symfony 2.0</h2>
            <ul>
              <li class="fragment">Initial alpha, Symfony Live Paris, February 2010</li>
              <li class="fragment">PHPBB: We're rebuilding on it!</li>
              <li class="fragment">Symfony2 uses 3rd party libs (Doctrine, Monolog)</li>
            </ul>
          </section>
          <section fullscreen-img="assets/history.jpg" class="fullscreen">
            <h2>Dependency Hell</h2>
            <img src="assets/hell-fire.jpg" alt="Dependencies are hell" data-credit="http://www.flickr.com/photos/31653823@N00/471628209" />
          </section>
          <section fullscreen-img="assets/history.jpg" class="fullscreen">
            <h2>We need a dependency system!</h2>
            <div class="fragment">
              <q>It's dumb to make it Symfony specific</q>
              <p>&mdash;Jordi Boggiano</p>
            </div>
          </section>
          <section fullscreen-img="assets/history.jpg" class="fullscreen">
            <h2>April 2011</h2>
            <p>Nils Aderman (PHPBB): libzypp -> PHP</p>
            <p class="fragment">Jordi Boggiano (Monolog): Packagist, less sucky front-end for PEAR</p>
          </section>
          <section fullscreen-img="assets/history.jpg" class="fullscreen">
            <h2>With their powers combined...</h2>
            <p><strong>Composer</strong> is a tool for <em>dependency management</em> in PHP. It allows you to declare the dependent libraries your project needs and it will install them in your project for you.</p>
          </section>
          <section fullscreen-img="assets/history.jpg" class="fullscreen">
            <h2>Uhh, what?</h2>
            <ul>
              <li class="fragment">No more Copy/Paste of libraries</li>
              <li class="fragment">Resolves dependencies</li>
              <li class="fragment">Each project defines its own requirements</li>
              <li class="fragment">Performs build tasks</li>
            </ul>
          </section>
          <section fullscreen-img="assets/history.jpg" class="fullscreen">
            <h2>September 2011</h2>
            <p><a href="http://packagist.org/">Packagist.org</a></p>
            <ol>
              <li class="fragment"><a href="https://packagist.org/packages/monolog/monolog">Monolog</a></li>
              <li class="fragment"><a href="https://packagist.org/packages/twig/twig">Twig</a></li>
              <li class="fragment"><a href="https://packagist.org/packages/pirum/pirum">Pirum</a></li>
              <li class="fragment"><a href="https://packagist.org/packages/swiftmailer/swiftmailer">Swiftmailer</a></li>
              <li class="fragment"><a href="https://packagist.org/packages/pimple/pimple">Pimple</a></li>
              <li class="fragment"><a href="https://packagist.org/packages/symfony/symfony">Symfony</a></li>
            </ol>
          </section>
          <section fullscreen-img="assets/history.jpg" class="fullscreen">
            <blockquote>I'd say until early 2012 it was pretty unusable, yet people used it. I guess that's how badly it was needed.</blockquote>
            <p>&mdash; Jordi Boggiano</p>
          </section>
          <section fullscreen-img="assets/history.jpg" class="fullscreen">
            <h2>Package count</h2>
            <img src="assets/packagist-usage.png" alt="Number of packages on Packagist over time" />
            <p>April 2013: 10,000 packages</p>
            <p>(Not just Symfony!)</p>
          </section>
        </section>
        <section>
          <section fullscreen-img="assets/libraries.jpg" class="fullscreen">
            <h1>Libraries</h1>
            <p>
              Some of the libraries available via Composer include...
            </p>
          </section>
          <section fullscreen-img="assets/libraries.jpg" class="fullscreen">
            <h2>
            <img src="assets/symfony.png" style="vertical-align:middle; border: none; background:none; width: 120px;">Symfony</h2>
            <p>PHP framework for web applications</p>
            <p><a href="http://symfony.com">http://symfony.com</a></p>
          </section>
          <section fullscreen-img="assets/libraries.jpg" class="fullscreen">
            <h2>Zend Framework</h2>
            <img src="assets/zend-framework.png" alt="Zend" style="background: none; border:none;">
            <p>PHP framework for web applications</p>
            <p><a href="http://framework.zend.com">http://framework.zend.com</a></p>
          </section>
          <section fullscreen-img="assets/libraries.jpg" class="fullscreen">
            <h2><img src="assets/phpunit.png" width="195" height="135" alt="PHPUnit" style="background:none; border: none; vertical-align: middle;"> PHPUnit</h2>
            <p>Unit testing software framework for PHP</p>
            <p><a href="http://phpunit.de">http://phpunit.de</a></p>
          </section>
          <section fullscreen-img="assets/libraries.jpg" class="fullscreen"><img src="assets/guzzle.png" width="175" height="221" alt="Guzzle" style="background: none; border: none; position: absolute; bottom:0; right:0; z-index:-1000;">
            <h2>Guzzle</h2>
            <p>HTTP client &amp; framework for building RESTful web service clients</p>
            <p><a href="http://guzzlephp.org/">http://guzzlephp.org</a></p>
          </section>
          <section fullscreen-img="assets/libraries.jpg" class="fullscreen">
            <h2>Solarium</h2>
            <img src="assets/solarium.gif" width="299" height="49" alt="Solarium" style="background: none; border:none;">
            <p>Solr client library for PHP</p>
            <p><a href="http://www.solarium-project.org/">http://solarium-project.org</a></p>
          </section>
          <section fullscreen-img="assets/libraries.jpg" class="fullscreen">
            <h2>Elastica</h2>
            <p>Elasticsearch search engine/database for PHP</p>
            <p><a href="http://elastica.io/">http://elastica.io</a></p>
          </section>
          <section fullscreen-img="assets/libraries.jpg" class="fullscreen">
            <h2>Monolog</h2>
            <p>Log to files, sockets, inboxes, databases and various web services</p>
            <p><a href="https://github.com/Seldaek/monolog">https://github.com/seldaek/monolog</a></p>
          </section>
          <section fullscreen-img="assets/libraries.jpg" class="fullscreen">
            <h2>Assetic</h2>
            <p>JavaScript, stylesheet, and image asset management</p>
            <p><a href="https://github.com/kriswallsmith/assetic">http://github.com/kriswallsmith/assetic</a></p>
          </section>
          <section fullscreen-img="assets/libraries.jpg" class="fullscreen">
            <h2>And 10,000 others</h2>
          </section>
        </section>
        <section>
          <section fullscreen-img="assets/yes.jpg" class="fullscreen">
            <h2>Let's Do This</h2>
          </section>
          <section fullscreen-img="assets/yes.jpg" class="fullscreen">
            <h2>Get Composer</h2>
            <dl>
              <dt>Quick 'n easy</dt>
              <dd>$ curl -sS https://getcomposer.org/installer | php</dd>
              <dt>Global</dt>
              <dd style="text-wrap: none;">$ curl -sS https://getcomposer.org/installer | php -- --install-dir=bin</dd>
            </dl>
          </section>
          <section fullscreen-img="assets/yes.jpg" class="fullscreen">
            <h2>Run Composer</h2>
            <p>$ composer.phar --version</p>
            <code>Composer version d498e7</code>
          </section>
          <section fullscreen-img="assets/yes.jpg" class="fullscreen">
            <h2>Setup</h2>
            <pre><code class="no-highlight">
-rw-rw-r-- composer.json (your composer file)
drwxrwxr-x src/          (your code)
drwxrwxr-x www/          (your code)
-rw-rw-r-- index.php     (your front controller)
</code></pre>
          </section>
          <section fullscreen-img="assets/yes.jpg" class="fullscreen">
            <h2>composer.json</h2>
            <p>Base manifest file for your project</p>
            <pre><code class="json">{
    "name": "crell/myapp",
    "description": "This app is amazing.",
    "require": {
        "guzzle/guzzle": "3.4.*"
    },
    "autoload": {
        "psr-0": {
            "MyName\\MyPackage": "src/"
        }
    }
}</code></pre>
          </section>
          <section fullscreen-img="assets/yes.jpg" class="fullscreen">
            <h2>composer install</h2>
            <p>Installs all dependencies for your project</p><pre><code class="no-highlight">
$ composer.phar install
Loading composer repositories with package information
Installing dependencies (including require-dev)
  - Installing symfony/event-dispatcher (v2.3.1)
    Downloading: 100%

  - Installing guzzle/guzzle (v3.4.3)
    Downloading: 100%

symfony/event-dispatcher suggests installing symfony/dependency-injection ()
symfony/event-dispatcher suggests installing symfony/http-kernel ()
Writing lock file
Generating autoload files
</code></pre>
          </section>
          <section fullscreen-img="assets/yes.jpg" class="fullscreen">
            <h2>And now</h2>
            <pre><code class="no-highlight">
-rw-rw-r-- composer.json (your composer file)
<span class="highlight">-rw-rw-r-- composer.lock (generated)</span>
drwxrwxr-x src/          (your code)
-rw-rw-r-- index.php     (your front controller)
<span class="highlight">drwxrwxr-x vendor/       (everyone else's code)</span>
</code></pre>
          </section>
          <section fullscreen-img="assets/yes.jpg" class="fullscreen">
            <h2>Only put these in Git</h2>
            <pre><code class="no-highlight">
<span class="highlight">-rw-rw-r-- composer.json (your composer file)</span>
<span class="highlight">-rw-rw-r-- composer.lock (generated)</span>
<span class="highlight">drwxrwxr-x src/          (your code)</span>
<span class="highlight">-rw-rw-r-- index.php     (your front controller)</span>
drwxrwxr-x vendor/       (everyone else's code)
</code></pre>
          </section>
          <section fullscreen-img="assets/yes.jpg" class="fullscreen">
            <h2>index.php</h2>
            <pre><code class="php">require_once __DIR__ . '/vendor/autoload.php';

// Every class is now yours to command!

// Autoload on demand! Your work: zero.
$client = new Guzzle\Http\Client('https://api.github.com');
$request = $client->get('/user')->setAuth('user', 'pass');
$response = $request->send();
echo $response->getBody();
</code></pre>
          </section>
          <section fullscreen-img="assets/yes.jpg" class="fullscreen">
            <h2>composer.lock</h2>
            <p>Your exact dependency commits.</p>
          </section>
          <section fullscreen-img="assets/yes.jpg" class="fullscreen">
            <h2>composer update</h3>
            <p>Updates all dependencies to the latest version</p>
            <pre><code class="no-highlight">
$ php composer.phar update
Loading composer repositories with package information
Updating dependencies
</code></pre>
          </section>
          <section fullscreen-img="assets/yes.jpg" class="fullscreen">
            <h2>What to use?</h2>
            <div style="float: left; width: 49%; text-align: left;">
              <h3>install</h3>
              <p>composer.lock? <br />&nbsp;&nbsp;=> Use it<p>
              <p>No? <br />&nbsp;&nbsp;=> Use composer.install</p>
            </div>
            <div style="float: right; width: 49%; text-align: left;">
              <h3>update</h3>
              <p>Use composer.install</p>
              <p>Generate a new composer.lock</p>
            </div>
          </section>
          <section fullscreen-img="assets/yes.jpg" class="fullscreen">
            <h2>Versioning</h2>
            <pre><code class="json">{
    "require": {
        "guzzle/guzzle": "3.4.*",
        "nocarrier/hal": ">=0.9, <=1.0",
        "pimple/pimple": "~1.0",
        "monolog/monolog": "dev-master#2eb0c097",
        "easyrdf/easyrdf": "0.8.*@3ebb7d",
        "php": ">=5.3.10",
        "ext-pdo": "*"
    }
}</code></pre>
          </section>
          <section class="json fullscreen" fullscreen-img="assets/yes.jpg">
            <h2>More Schema Options</h2>
            <p><a href="http://getcomposer.org/doc/04-schema.md">Schema Documentation</a></p>
            <pre><code class="json">{
    "license": "MIT",
    "require-dev": {
        "phpunit/phpunit": "3.7.*@dev"
    },
    "suggest": {
        "monolog/monolog": "Advanced logging package"
    },
    "config": {
        "vendor-dir": "core/vendor",
        "preferred-install": "dist"
    },
    "minimum-stability": "stable"
}</code></pre>
          </section>
          <section class="json fullscreen" fullscreen-img="assets/yes.jpg">
            <h2>Autoloading</h2>
            <pre><code class="json">{
    "autoload": {
        "psr-0": {
            "Drupal\\Core\\": "core/lib/",
        },

        "classmap": ["src/", "legacy/", "Pimple.php"],

        "files": ["src/utility_functions.php"]
    }
}</code></pre>
          </section>
          <section class="json fullscreen" fullscreen-img="assets/yes.jpg">
            <h2>Production</h2>
            <pre><code class="no-highlight">
$ composer.phar install --no-dev --prefer-dist --optimize-autoloader
</code></pre>
            <p></p>
          </section>
        </section>
        <section>
          <section>
            <h1>Your turn</h1>
          </section>
          <section>
            <h2>ApiProblem</h2>
            <ul>
              <li>Simple utility library</li>
              <li><a href="">IETF draft spec</a></li>
              <li><a href="http://www.github.com/Crell/ApiProblem">GitHub</a></li>
            </ul>
          </section>
          <section>
            <h2>ApiProblem</h2>
            <pre><code class="no-highlight">
-rw-rw-r-- composer.json
-rw-rw-r-- LICENSE
-rw-rw-r-- phpunit.xml.dist
-rw-rw-r-- README.md
drwxrwxr-x src
drwxrwxr-x tests
</code></pre>
          </section>
          <section>
            <h2>composer.json</h2>
            <pre><code class="json">{
    "name": "crell/api-problem",
    "description": "PHP wrapper for the api-problem IETF specification",
    "license": "MIT",
    "keywords": ["api-problem", "rest", "http", "json", "xml"],
    "homepage": "https://github.com/Crell/ApiProblem",
    "authors": [{
            "name": "Larry Garfield",
            "email": "larry@garfieldtech.com",
            "homepage": "http://www.garfieldtech.com/"
     }],
    "autoload": {
        "psr-0": {"Crell\\ApiProblem": "src/"}
    },
    "require": {
        "php": ">=5.3.3"
    },
    "require-dev": {
        "phpunit/phpunit": "3.7.*"
    }
}</code></pre>
          </section>
          <section>
            <h2>On GitHub</h2>
            <img src="assets/api-problem-github.png" alt="ApiProblem is on GitHub." />
          </section>
          <section>
            <h2>Packagist.org</h2>
            <img src="assets/crell-packagist.png" alt="ApiProblem is on Packagist." />
          </section>
          <section>
            <h2>GitHub-Packagist</h2>
            <img src="assets/api-problem-github-config.png" alt="Packagist is on GitHub." />
          </section>
          <section>
            <h2>GitHub-Packagist</h2>
            <img src="assets/api-problem-packagist.png" alt="ApiProblem is on Packagist." />
          </section>
          <section>
            <h2>In your code</h2>
             <pre><code class="json">{
    "require": {

        "crell/api-problem": "1.0-beta1"
    }
}</code></pre>
          </section>
          <section>
            <h2>Private Repositories</h2>
            <p><em>Satis</em> allows you to host your own Composer repositories</p>
                        <pre><code class="json">{
  "repositories": [
    {
      "type": "composer",
      "url": "http://packages.example.org/"
    }
  ],
  "require": {
    "company/package": "1.2.0",
    "company/package2": "1.5.2",
    "company/package3": "dev-master"
  }
}</code></pre>
            <p><a href="http://getcomposer.org/doc/articles/handling-private-packages-with-satis.md">github.com/composer/satis</a></p>
          </section>
        </section>
        <section>
          <p>"Do it manually and pray" is for losers</p>
          <p class="fragment roll-in" style="margin-top: 1em; font-style: italic;">With Composer, you can do better than that.</p>
        </section>
        <section>
          <h2>Stalk me!</h2>
          <p><a href="http://www.palantir.net/">http://www.palantir.net/</a></p>
          <p><a href="http://www.garfieldtech.com/">http://www.garfieldtech.com/</a></p>
          <p><a href="http://twitter.com/Crell">@Crell</a></p>

          <h3 style="margin-top: 1em;">Review this session</h3>
          <p><a href="https://joind.in/talk/view/8690">https://joind.in/talk/view/8690</a></p>

          <h3 style="margin-top: 1em;">Thanks!</h3>
        </section>
      </div>
    </div>
    <script type="text/javascript" src="components/require.js" data-main="drupalcon2013"></script>
  </body>
</html>
